<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OldWar</title>
</head>
<body>
  <script>
    class Personaje {
      constructor(nombre, vida, daño, defensa, velocidad) {
        this.nombre = nombre;
        this.vida = vida;
        this.daño = daño;
        this.defensa = defensa;
        this.velocidad = velocidad;
      }

      atacar() {
        return this.daño;
      }

      saludar() {
        console.log(`Hola, soy ${this.nombre} y soy un ${this.constructor.name}.`);
      }
    }

    class Guerrero extends Personaje {
      constructor(nombre, vida, daño, defensa, velocidad, armas) {
        super(nombre, vida, daño, defensa, velocidad);
        this.armas = armas;
      }

      atacar_con_arma() {
        const armaAleatoria = this.armas[Math.floor(Math.random() * this.armas.length)];
        console.log(`${this.nombre} ataca con ${armaAleatoria}.`);
        return this.daño + Math.floor(Math.random() * 10);
      }
    }

    class Mago extends Personaje {
      constructor(nombre, vida, daño, defensa, velocidad, hechizos) {
        super(nombre, vida, daño, defensa, velocidad);
        this.hechizos = hechizos;
      }

      atacar_con_hechizo() {
        const hechizoAleatorio = this.hechizos[Math.floor(Math.random() * this.hechizos.length)];
        console.log(`${this.nombre} lanza ${hechizoAleatorio}.`);
        return this.daño + Math.floor(Math.random() * 15);
      }
    }

    class Arquero extends Personaje {
      constructor(nombre, vida, daño, defensa, velocidad, array_de_flechas) {
        super(nombre, vida, daño, defensa, velocidad);
        this.array_de_flechas = array_de_flechas;
      }

      disparar() {
        const flechaAleatoria = this.array_de_flechas[Math.floor(Math.random() * this.array_de_flechas.length)];
        console.log(`${this.nombre} dispara ${flechaAleatoria}.`);
        return this.daño + Math.floor(Math.random() * 5);
      }
    }

    class Juego {
      constructor() {
        this.personajes = [
          new Guerrero("Guts", 120, 20, 15, 10, ["Espada", "Hacha", "Lanza"]),
          new Guerrero("Leonidas", 130, 18, 16, 8, ["Espada", "Escudo"]),
          new Mago("Gandalf", 80, 25, 10, 12, ["Bola de fuego", "Rayo de hielo", "Tormenta eléctrica"]),
          new Mago("Merlín", 90, 22, 8, 14, ["Ilusión", "Teletransporte", "Explosión arcana"]),
          new Arquero("Legolas", 100, 18, 12, 15, ["Flecha normal", "Flecha envenenada", "Flecha explosiva"])
        ];
      }

      iniciarJuego() {
        this.personajes.forEach(personaje => personaje.saludar());

        let ronda = 1;
        while (this.personajes.filter(p => p.vida > 0).length > 1) {
          console.log(`\n--- Ronda ${ronda} ---`);

          // Ordenar personajes por velocidad
          const personajesOrdenados = [...this.personajes.filter(pO => pO.vida > 0)]
            .sort((a, b) => {
              const velocidadA = Math.random() * a.velocidad;
              const velocidadB = Math.random() * b.velocidad;
              return velocidadB - velocidadA;
            });

          // Cada personaje ataca una vez por ronda
          personajesOrdenados.forEach(atacante => {
            if (atacante.vida <= 0) return;

            const objetivos = this.personajes.filter(p => p.vida > 0 && p !== atacante);
            if (objetivos.length === 0) return;

            const objetivo = objetivos[Math.floor(Math.random() * objetivos.length)];

            // Decidir si ataca con puños o con arma/hechizo/flecha
            const usarHabilidadEspecial = Math.random() < 2/3;

            let daño;
            if (usarHabilidadEspecial) {
              if (atacante instanceof Guerrero) {
                daño = atacante.atacar_con_arma();
              } else if (atacante instanceof Mago) {
                daño = atacante.atacar_con_hechizo();
              } else if (atacante instanceof Arquero) {
                daño = atacante.disparar();
              }
            } else {
              daño = atacante.atacar();
              console.log(`${atacante.nombre} ataca con sus puños.`);
            }

            // El objetivo intenta defenderse
            const defensaExitosa = Math.random() * objetivo.defensa > daño;

            if (defensaExitosa) {
              console.log(`${objetivo.nombre} se defendió exitosamente del ataque de ${atacante.nombre}.`);
            } else {
              objetivo.vida -= daño;
              console.log(`${atacante.nombre} atacó a ${objetivo.nombre} y le hizo ${daño} de daño. Vida restante de ${objetivo.nombre}: ${objetivo.vida}`);

              if (objetivo.vida <= 0) {
                console.log(`${objetivo.nombre} ha muerto y no puede atacar más.`);
              }
            }
          });

          ronda++;
        }

        // Determinar el ganador
        const ganador = this.personajes.find(p => p.vida > 0);
        console.log(`\n--- Fin del juego ---`);
        console.log(`El ganador es ${ganador.nombre}, un ${ganador.constructor.name}.`);
      }
    }

    // Iniciar el juego
    const juego = new Juego();
    juego.iniciarJuego();
  </script>
</body>
</html>